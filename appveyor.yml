version: 1.0.{build}

branches:
  # whitelist
  only:
    - master

before_build:
  - nuget restore AcademicMarketplace.sln
  - npm install --save-dev jasmine-node -g
  - npm install --save-dev frisby

build_script:
  - msbuild "C:\projects\academicmarketplace\AcademicMarketplace.sln" /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"

test_script:
  - cmd: netstat -a
  - cmd: echo Starting background process for AcademicMarketplace app
  - ps: $MyProcess = Start-Process runit.cmd -PassThru
  - cmd: echo Sleeping a bit to let it come up
  - ps: Start-Sleep -s 10
  - cmd: echo Running API tests
  - cmd: jasmine-node api_tests/
  - cmd: Stopping background AcademicMarketplace app
  - ps: Stop-Process -Id $MyProcess.Id
  - cmd: echo Finished

test:
  assemblies:
    - '**\*.UnitTesting.dll'
